{% extends "myapp/manager_base.html" %}
{% block content %}
{% include 'myapp/chatbot.html' %}
<h2 class="text-2xl font-bold mb-6">Employee Leave Reports</h2>

<!-- ---------------- Direct Employees ---------------- -->
<h3 class="text-xl font-semibold mb-3 text-blue-700">Direct Employees</h3>
<table class="w-full bg-white rounded shadow mb-10">
  <thead>
    <tr class="bg-gray-200">
      <th class="p-3 text-left">Employee</th>
      <th class="p-3 text-left">Leave Type</th>
      <th class="p-3 text-left">Used</th>
      <th class="p-3 text-left">Remaining</th>
      <th class="p-3 text-left">Total</th>
    </tr>
  </thead>
  <tbody>
    {% for emp in direct_reports %}
      {% for lt_name, bal in emp.balances.items %}
        <tr>
          {% if forloop.first %}
            <td class="border p-2" rowspan="{{ emp.balances|length }}">
              {{ emp.employee.username }}
            </td>
          {% endif %}
          <td class="border p-2">{{ lt_name }}</td>
          <td class="border p-2">{{ bal.used }}</td>
          <td class="border p-2">{{ bal.remaining }}</td>
          <td class="border p-2">{{ bal.total }}</td>
        </tr>
      {% endfor %}
    {% empty %}
      <tr>
        <td colspan="5" class="p-3 text-center text-gray-500">
          No direct employees found.
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>


<!-- ---------------- Project Employees ---------------- -->
<h3 class="text-xl font-semibold mb-3 text-green-700">Project Members</h3>
<table class="w-full bg-white rounded shadow">
  <thead>
    <tr class="bg-gray-200">
      <th class="p-3 text-left">Employee</th>
      <th class="p-3 text-left">Leave Type</th>
      <th class="p-3 text-left">Used</th>
      <th class="p-3 text-left">Remaining</th>
      <th class="p-3 text-left">Total</th>
    </tr>
  </thead>
  <tbody>
    {% for emp in project_reports %}
      {% for lt_name, bal in emp.balances.items %}
        <tr>
          {% if forloop.first %}
            <td class="border p-2" rowspan="{{ emp.balances|length }}">
              {{ emp.employee.username }}
            </td>
          {% endif %}
          <td class="border p-2">{{ lt_name }}</td>
          <td class="border p-2">{{ bal.used }}</td>
          <td class="border p-2">{{ bal.remaining }}</td>
          <td class="border p-2">{{ bal.total }}</td>
        </tr>
      {% endfor %}
    {% empty %}
      <tr>
        <td colspan="5" class="p-3 text-center text-gray-500">
          No project members found.
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

{% endblock %}
