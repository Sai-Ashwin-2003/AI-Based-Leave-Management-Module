{% extends "myapp/manager_base.html" %}

{% block content %}
<h2 class="text-2xl font-semibold text-gray-800 mb-4">Leave Calendar</h2>
<div id="leave_calendar" class="text-2xl font-bold mb-2"></div>

<h2 class="text-2xl font-semibold text-gray-800 mb-4 mt-8">Leave Balance</h2>
<div class="overflow-x-auto">
    <table class="min-w-full bg-white rounded-lg shadow">
        <thead class="bg-gray-50 text-gray-600 text-xs uppercase tracking-wider">
            <tr>
                <th class="px-6 py-3 border-b">Leave Type</th>
                <th class="px-6 py-3 border-b">Used</th>
                <th class="px-6 py-3 border-b">Remaining</th>
                <th class="px-6 py-3 border-b">Total</th>
            </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
            {% for leave_type, bal in balances.items %}
            <tr>
                <td class="px-6 py-4">{{ leave_type }}</td>
                <td class="px-6 py-4">{{ bal.used }}</td>
                <td class="px-6 py-4">{{ bal.remaining }}</td>
                <td class="px-6 py-4">{{ bal.total }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="4" class="px-6 py-4 text-center text-gray-500">No leave types defined yet.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var leaveDates = JSON.parse('{{ leave_dates_json|escapejs }}');

    flatpickr("#leave_calendar", {
        inline: true,
        onDayCreate: function(dObj, dStr, fp, dayElem) {
            var dateStr = dayElem.dateObj.getFullYear() + '-' +
                          String(dayElem.dateObj.getMonth()+1).padStart(2,'0') + '-' +
                          String(dayElem.dateObj.getDate()).padStart(2,'0');
            if (leaveDates.includes(dateStr)) {
                dayElem.style.backgroundColor = "red";
                dayElem.style.color = "white";
            }
        }
    });
});
</script>

{% endblock %}
