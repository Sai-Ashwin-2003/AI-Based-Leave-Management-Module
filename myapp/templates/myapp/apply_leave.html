{% extends 'myapp/base_dashboard.html' %}
{% block content %}
{% include 'myapp/chatbot.html' %}

{% if messages %}
<div id="messages-container" class="fixed top-4 right-4 z-50 space-y-2">
  {% for message in messages %}
    <div class="p-3 rounded shadow text-sm font-medium
                {% if message.tags == 'error' %}bg-red-100 text-red-800 border border-red-200
                {% elif message.tags == 'success' %}bg-green-100 text-green-800 border border-green-200
                {% else %}bg-blue-100 text-blue-800 border border-blue-200{% endif %} animate-slide-in">
      {{ message }}
    </div>
  {% endfor %}
</div>
{% endif %}

<h2 class="text-2xl font-semibold text-gray-800 mb-6">Apply for Leave</h2>

<div class="bg-white shadow-md rounded-lg p-6">
  <form id="leaveForm" method="post" class="space-y-4">
    {% csrf_token %}
    <div>
      <label class="block font-medium mb-1">Leave Type</label>
      <select name="leave_type" class="w-full p-2 border rounded focus:ring-2 focus:ring-indigo-500" required>
        {% for lt in leave_types %}
          <option value="{{ lt.id }}">{{ lt.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block font-medium mb-1">Start Date</label>
      <input type="text" id="start_date" name="start_date" class="w-full p-2 border rounded" placeholder="Select start date" required>
    </div>
    <div>
      <label class="block font-medium mb-1">End Date</label>
      <input type="text" id="end_date" name="end_date" class="w-full p-2 border rounded" placeholder="Select end date" required>
    </div>
    <div>
      <label class="block font-medium mb-1">Reason</label>
      <textarea name="reason" class="w-full p-2 border rounded" required></textarea>
    </div>
    <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">
      Submit
    </button>
  </form>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>


<script>
  setTimeout(() => {
    const messages = document.getElementById('messages-container');
    if (messages) { messages.style.opacity = 0; setTimeout(() => messages.remove(), 500); }
  }, 7000);

  flatpickr("#start_date", { altInput:true, altFormat:"F j, Y", dateFormat:"Y-m-d", minDate:"today" });
  flatpickr("#end_date", { altInput:true, altFormat:"F j, Y", dateFormat:"Y-m-d", minDate:"today" });

  document.getElementById("leaveForm").addEventListener("submit", function(e){
    const startDate = document.getElementById("start_date").value;
    const endDate = document.getElementById("end_date").value;
    if (!startDate || !endDate || new Date(endDate) < new Date(startDate)) {
      e.preventDefault(); alert("Please enter valid start and end dates.");
    }
  });
</script>


<style>
  @keyframes slide-in { 0%{ transform: translateX(100px); opacity: 0; } 100%{ transform: translateX(0); opacity:1; } }
  .animate-slide-in { animation: slide-in 0.3s ease-out forwards; }

</style>
{% endblock %}
